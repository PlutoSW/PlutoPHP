const MARKER_PREFIX=`pluto-${Math.random().toString(36).slice(2)}-`,PlutoImplements={},PlutoComponents={},EVENT_REGISTRY=new Map,lazyRegistry=new Map;class UnsafeHTML{constructor(t){this.value=t}}window.unsafeHTML=t=>new UnsafeHTML(t);class TemplateResult{constructor(t,e){this.strings=t,this.values=e}}function resolveTemplate(t){if(t instanceof TemplateResult){let e="";return t.strings.forEach(((s,n)=>{const i=s.match(/@([a-zA-Z0-9_-]+)=["']?$/);if(i&&n<t.values.length&&"function"==typeof t.values[n]){const o=`evt-${Math.random().toString(36).slice(2)}`,r=i[1];EVENT_REGISTRY.set(o,{name:r,fn:t.values[n]}),e+=s.substring(0,s.length-i[0].length),e+=` data-pluto-event="${o}"`}else e+=s,n<t.values.length&&(e+=resolveTemplate(t.values[n]))})),e}return Array.isArray(t)?t.map(resolveTemplate).join(""):t instanceof UnsafeHTML?t.value:escapeHtml(t)}window.html=(t,...e)=>new TemplateResult(t,e),window.css=(t,...e)=>t.reduce(((t,s,n)=>t+s+(e[n]||"")),""),window.escapeHtml=t=>null==t?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");const bindAttributes=(t,e,s)=>{const n=t.name.slice(1),i=t.value;let o;o=i.includes("(")?`this.${i}`:`this.${i}($event)`;const r=new Function("$event",o);s.addEventListener(n,r.bind(e))};class NodePart{constructor(t,e,s){this.parentNode=t,this.marker=e,this.nodes=[],this.value=void 0,this.component=s}update(t){if(this.value!==t){if(Array.isArray(t)||t instanceof TemplateResult){const e=resolveTemplate(t),s=document.createElement("template");s.innerHTML=e;const n=Array.from(s.content.childNodes);this._commit(n)}else if(t instanceof UnsafeHTML){const e=document.createElement("template");e.innerHTML=t.value;const s=Array.from(e.content.childNodes);this._commit(s)}else{const e=String(t??"");1===this.nodes.length&&this.nodes[0].nodeType===Node.TEXT_NODE?this.nodes[0].textContent!==e&&(this.nodes[0].textContent=e):this._commit([document.createTextNode(e)])}this.value=t}}_commit(t){this.nodes.forEach((t=>t.remove()));let e=this.marker;for(const s of t)this.parentNode.insertBefore(s,e.nextSibling),e=s;this.nodes=t,this._bindNestedEvents(t),this._bindAttributes(t),this.component._applyImplementations(this.parentNode)}_bindNestedEvents(t){t.forEach((t=>{if(1===t.nodeType){if(t.hasAttribute("data-pluto-event")){const e=t.getAttribute("data-pluto-event"),s=EVENT_REGISTRY.get(e);if(s){const n=s.fn.bind(this.component);t.addEventListener(s.name,n),EVENT_REGISTRY.delete(e)}t.removeAttribute("data-pluto-event")}t.querySelectorAll("[data-pluto-event]").forEach((t=>{const e=t.getAttribute("data-pluto-event"),s=EVENT_REGISTRY.get(e);if(s){const n=s.fn.bind(this.component);t.addEventListener(s.name,n),EVENT_REGISTRY.delete(e)}t.removeAttribute("data-pluto-event")}))}}))}_bindAttributes(t){t.forEach((t=>{if(1!==t.nodeType)return;const e=t=>{Array.from(t.attributes).forEach((e=>{e.name.startsWith("@")&&(bindAttributes(e,this.component,t),t.removeAttribute(e.name))}))};e(t),t.querySelectorAll("*").forEach(e)}))}}class AttributePart{constructor(t,e,s,n){this.element=t,this.name=e.replace(/-(\w)/g,((t,e)=>e.toUpperCase())),this.type=s,this.component=n,this.value=void 0,this.boundListener=void 0}update(t){if(this.value!==t){if("event"===this.type)this.boundListener&&this.element.removeEventListener(this.name,this.boundListener),t?(this.boundListener=t.bind(this.component),this.element.addEventListener(this.name,this.boundListener)):this.boundListener=void 0;else if("prop"===this.type)this.element[this.name]=t;else if("boolean"===this.type)t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name);else{if(null==t||"null"===t)return void this.element.removeAttribute(this.name);this.element.setAttribute(this.name,t)}this.value=t}}}window.log=console.log,window.error=console.error;class PlutoElement extends HTMLElement{constructor(){super(),!0!==this.constructor.noShadow?(this.attachShadow({mode:"open"}),this.wrapper=document.createElement("pluto-component"),this.shadowRoot.appendChild(this.wrapper)):this.wrapper=this,this._updatePending=!1,this._props={},this._parts=[],this._lastStrings=null,this._isInternalCall=!1,this.initStyles(),this.id&&(PlutoComponents[this.id]=this)}static get props(){return{}}styles(){return""}static get observedAttributes(){const t=this.props;return Object.keys(t).map((t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))}attributeChangedCallback(t,e,s){if(e===s)return;"id"===t&&(PlutoComponents[s]=this);const n=t.replace(/-(\w)/g,((t,e)=>e.toUpperCase())),i=this.constructor.props;if(i[n]){const t=i[n].type;let e=s;if(t===Number)e=Number(s);else if(t===Boolean)e="false"!==s;else if(t===Object||t===Array)try{e=JSON.parse(s)}catch(t){}this[n]||this?.onPropCreate?.(n,e),this[n]=e}}get domLocation(){return this._domLocation}connectedMoveCallback(){this._domLocation={parent:this.parentNode,index:Array.from(this.parentNode.children).indexOf(this)}}adoptedCallback(){this._domLocation={parent:this.parentNode,index:Array.from(this.parentNode.children).indexOf(this)}}dispatch(t,e){"string"==typeof t&&(t=new CustomEvent(t,{detail:e})),this.dispatchEvent(t)}attr(t,e){return void 0===e?this.getAttribute(t):("object"==typeof e&&Object.keys(e).forEach((t=>{this.setAttribute(t,e[t])})),"string"==typeof e&&this.setAttribute(t,e),this)}removeAttr(t){return t.split(" ").forEach((t=>{this.removeAttribute(t)})),this}async connectedCallback(){this._initializeProps(),await(this?.onConnect?.()),await this.requestUpdate(),this._domLocation={parent:this.parentNode,index:Array.from(this.parentNode.children).indexOf(this)},this?.onReady?.()}initStyles(){const t=this?.styles?.();if(!t)return"";if(this.styleElement=document.createElement("style"),Array.isArray(t)){let e="";t.forEach((t=>{e+=`@import "${t}";`})),this.styleElement.textContent=e}else this.styleElement.textContent=t;this.shadowRoot.appendChild(this.styleElement)}disconnectedCallback(){this?.onDisconnect?.(this.domLocation)}_initializeProps(){const t=this.constructor.props;for(const e of Object.keys(t)){let s;this.hasOwnProperty(e)&&(s=this[e],delete this[e]),Object.defineProperty(this,e,{get(){t[e];return this._props[e]},set(n){t[e];this._props[e]!==n&&(this._props[e]=n,this?.onPropUpdate?.(e,s,n),this.requestUpdate())},configurable:!0}),void 0!==s&&(this[e]=s)}}async requestUpdate(){this.onBeforeRender(),this._updatePending||(this._updatePending=!0,await Promise.resolve(),await this._performUpdate(),this._updatePending=!1,this.onAfterRender())}onBeforeRender(){}onAfterRender(){}async _performUpdate(){const t=await this.render();t&&(this._lastStrings!==t.strings?this._fullRender(t):this._updateParts(t.values))}_fullRender(t){this._lastStrings=t.strings,this._parts=[];let e="";const s=t.strings;for(let t=0;t<s.length-1;t++){const n=s[t];e+=n.match(/([?@.]?[a-zA-Z0-9_-]+)=["']?$/)?n+`"${MARKER_PREFIX}${t}"`:n+`\x3c!--${MARKER_PREFIX}${t}--\x3e`}e+=s[s.length-1],this.wrapper.innerHTML=e,this._hydrate(t.values),this._applyImplementations(this.wrapper)}_hydrate(t){const e=document.createTreeWalker(this.wrapper,NodeFilter.SHOW_COMMENT,null,!1);let s;for(;s=e.nextNode();){const e=s.textContent;if(e.startsWith(MARKER_PREFIX)){const n=parseInt(e.replace(MARKER_PREFIX,""));this._parts[n]=new NodePart(s.parentNode,s,this),this._parts[n].update(t[n])}}this.wrapper.querySelectorAll("*").forEach((e=>{Array.from(e.attributes).forEach((s=>{if(s.value.startsWith(MARKER_PREFIX)){const n=parseInt(s.value.replace(MARKER_PREFIX,"")),i=s.name;let o="attr",r=i;i.startsWith(".")?(o="prop",r=i.slice(1)):i.startsWith("@")?(o="event",r=i.slice(1)):i.startsWith("?")&&(o="boolean",r=i.slice(1)),this._parts[n]=new AttributePart(e,r,o,this),this._parts[n].update(t[n])}else if(".model"===s.name){const t=s.value;if(!t)return;e.value=this[t];const n="pluto-checkbox"===e.tagName.toLowerCase()||"pluto-radio"===e.tagName.toLowerCase()?"change":"input";e.addEventListener(n,(e=>{this[t]="pluto-checkbox"===e.target.tagName.toLowerCase()?e.target.checked:e.target.value}))}else s.name.startsWith("@")&&(bindAttributes(s,this,e),e.removeAttribute(s.name))}))}))}_updateParts(t){t.forEach(((t,e)=>{this._parts[e]&&this._parts[e].update(t)}))}async render(){return html``}_applyImplementations(t){if(t&&"function"==typeof t.querySelectorAll)for(const e in PlutoImplements)if(Object.hasOwnProperty.call(PlutoImplements,e)){t.querySelectorAll(e).forEach((t=>{const s=PlutoImplements[e];if(s.attrs)for(const e in s.attrs)t.setAttribute(e,s.attrs[e]);if(s.props)for(const e in s.props)t[e]=s.props[e];if(s.methods)for(const e in s.methods)t[e]=s.methods[e];if(s.events)for(const e in s.events)t.addEventListener(e,s.events[e])}))}}on(t,e){return t.split(" ").forEach((t=>{this.addEventListener(t,e)})),this}off(t,e){return t.split(" ").forEach((t=>{this.removeEventListener(t,e)})),this}}window.PlutoElement=PlutoElement,window.Pluto={assign:(t,e=null)=>{if(!e)throw new Error("Component is not defined");t=t.includes("-")?t:"pluto-"+t,customElements.define(t,e)},implement(t,e={}){return t.includes(" ")?(t.split(" ").forEach((t=>{PlutoImplements[t]=e})),this):(PlutoImplements[t]=e,this)},lazy:(t,e)=>{if(!customElements.get(t)){lazyRegistry.set(t,e);class s extends HTMLElement{_observer;connectedCallback(){this._observer=new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting&&(e.unobserve(this),this._loadComponent())}))}),{rootMargin:"200px"}),this._observer.observe(this)}disconnectedCallback(){this._observer?.disconnect()}_loadComponent(){const t=document.createElement("script");t.src=e,document.head.appendChild(t)}}customElements.define(t,s)}},component:t=>PlutoComponents[t]};